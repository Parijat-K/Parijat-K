import React, { useState, useMemo, useEffect } from 'react';
import { 
  Mail, Phone, MapPin, Linkedin, Github, Globe, ExternalLink, 
  Award, GraduationCap, BookOpen, Briefcase, FolderGit, Cpu, 
  Quote, ArrowRight, Menu, X, Download, Printer, ChevronRight, 
  Copyright, Search, Tag, ArrowLeft, Calendar, FileText, Layers,
  ChevronLeft, Copy, Check, Bot
} from 'lucide-react';

const App = () => {
  const [currentView, setCurrentView] = useState('home'); // 'home' | 'cv' | 'projects' | 'research' | 'project-detail' | 'research-detail'
  const [detailId, setDetailId] = useState(null);
  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
  const [isSearchOpen, setIsSearchOpen] = useState(false);
  
  // Contact Modal State
  const [isContactOpen, setIsContactOpen] = useState(false);
  const [emailCopied, setEmailCopied] = useState(false);
  
  // Search & Pagination States
  const [globalSearchQuery, setGlobalSearchQuery] = useState('');
  const [projectSearchQuery, setProjectSearchQuery] = useState('');
  const [researchSearchQuery, setResearchSearchQuery] = useState('');
  const [projectsPage, setProjectsPage] = useState(1);
  const [researchPage, setResearchPage] = useState(1);

  const ITEMS_PER_PAGE = 6;

  // --- USER DATA ---
  const resumeData = {
    header: {
      name: "Dr. Alex Dev",
      title: "Senior Software Engineer & Researcher",
      summary: "Polyglot engineer and researcher with a Ph.D. in Distributed Systems. Expert in building scalable enterprise backend systems, data science pipelines, and cross-platform mobile applications. Proven track record of bridging the gap between academic research and production-grade engineering in Java, .NET, and Python ecosystems.",
      location: "San Francisco, CA",
      email: "alex.dev@example.com",
      phone: "+1 (555) 123-4567",
      linkedin: "linkedin.com/in/alexdev",
      github: "github.com/alexdev",
      website: "alexdev.io"
    },
    skills: [
      {
        category: "AI & Agent Systems",
        items: ["Agent Dev (Pydantic)", "LLMs & RAG", "LangChain", "Vector Databases", "OpenAI API", "Semantic Kernel"]
      },
      {
        category: "Algorithmic Optimization",
        items: ["Constraint Programming", "Discrete Optimization", "Google OR-Tools", "Distributed Consensus"]
      },
      {
        category: "Java Ecosystem",
        items: ["Java 17", "Spring Boot", "Hibernate", "JPA", "Gradle", "Maven", "JUnit 5", "Kafka", "Quarkus"]
      },
      {
        category: ".NET Stack",
        items: ["C#", ".NET MAUI", "ASP.NET Core", "Blazor", "Entity Framework", "LINQ", "Azure Functions", "SQL Server"]
      },
      {
        category: "Python & Data",
        items: ["Python 3.11", "Django", "FastAPI", "Pandas", "NumPy", "PyTorch", "Celery", "Jupyter"]
      },
      {
        category: "Frontend & Mobile",
        items: ["TypeScript", "React", "Next.js", "Tailwind CSS", "Flutter", "Kotlin Multiplatform (KMP)"]
      },
      {
        category: "DevOps & Tools",
        items: ["Docker", "Kubernetes", "AWS (EC2, S3, RDS)", "Terraform", "GitHub Actions", "Linux"]
      }
    ],
    experience: [
      {
        company: "TechFlow Solutions",
        period: "2021 – Present",
        roles: [
          {
            title: "Senior Backend Engineer",
            period: "Jan 2023 – Present",
            description: [
              "Architected and migrated the legacy monolith to a microservices architecture using Java 17 and Spring Boot, improving system scalability by 300%.",
              "Designed high-throughput event processing pipelines using Apache Kafka and Hibernate."
            ]
          },
          {
            title: "Software Engineer",
            period: "Jun 2021 – Dec 2022",
            description: [
              "Implemented a rigorous CI/CD pipeline using GitHub Actions, reducing deployment time from 1 hour to 10 minutes.",
              "Mentored junior developers on C# and .NET Core best practices during a strategic platform integration."
            ]
          }
        ]
      },
      {
        company: "Innovate Corp",
        period: "2018 – 2021",
        roles: [
          {
            title: "Full Stack Engineer",
            period: "2018 – 2021",
            description: [
              "Developed and maintained RESTful APIs with Python (Django) used by over 50,000 daily active users.",
              "Optimized database queries in PostgreSQL and SQL Server, reducing average query time by 50ms.",
              "Collaborated with data science teams to integrate PyTorch models into production web services."
            ]
          }
        ]
      },
      {
        company: "StartUp Inc",
        period: "2017 – 2018",
        roles: [
          {
            title: "Junior Developer",
            period: "2017 – 2018",
            description: [
              "Built responsive UI components using React and Styled Components.",
              "Assisted in backend development with Python for internal data tools.",
              "Fixed critical bugs in the production environment, improving application stability."
            ]
          }
        ]
      },
      {
        company: "Legacy Systems Inc",
        period: "2015 – 2017",
        roles: [
          {
            title: "Software Developer Intern",
            period: "2015 – 2017",
            description: [
              "Maintained legacy ASP.NET Web Forms applications and assisted in migration to MVC.",
              "Wrote SQL scripts for data patching and reporting.",
              "Participated in daily stand-ups and sprint planning sessions."
            ]
          }
        ]
      }
    ],
    projects: [
      {
        id: "p1",
        name: "CloudMonitor",
        tech: "Go, React, AWS",
        tags: ["Go", "Distributed Systems", "React", "AWS", "Monitoring"],
        description: "An open-source server monitoring tool that visualizes real-time metrics.",
        longDescription: "CloudMonitor is a high-performance observability tool designed to replace expensive SaaS solutions for mid-sized clusters. It collects CPU, Memory, and I/O metrics via a lightweight Go agent and visualizes them in a real-time React dashboard.",
        challenges: "Handling high-cardinality metrics ingestion without overwhelming the time-series database. Implemented a custom buffering strategy in the Go agent to batch writes.",
        outcome: "Adopted by 3 major startups, 500+ stars on GitHub, and reduces monitoring costs by approx 60%.",
        link: "github.com/alexdev/cloudmonitor",
        featured: true
      },
      {
        id: "p2",
        name: "TaskMaster",
        tech: "C#, .NET, Azure",
        tags: ["C#", ".NET", "Real-time", "Azure", "Productivity"],
        description: "A collaborative project management app with real-time updates using SignalR.",
        longDescription: "TaskMaster allows distributed teams to manage Kanban boards with sub-second latency updates. Built on .NET 8 and utilizing Azure SignalR Service for managing websocket connections at scale.",
        challenges: "Ensuring state consistency across multiple clients during network partitions. Utilized a Last-Write-Wins CRDT approach for conflict resolution.",
        outcome: "Scaled to 10k concurrent users during stress testing with <100ms latency.",
        link: "taskmaster.app",
        featured: true
      },
      {
        id: "p3",
        name: "ShopStream",
        tech: "Kafka, Java, Redis",
        tags: ["Java", "Kafka", "E-commerce", "Big Data", "Redis"],
        description: "A high-throughput event streaming platform for e-commerce analytics.",
        longDescription: "ShopStream ingests clickstream data from e-commerce frontends and processes user behavior patterns in real-time to generate personalized recommendations.",
        challenges: "Processing 50k events/sec with strict ordering guarantees for specific user sessions.",
        outcome: "Improved recommendation click-through rate by 15% due to real-time context awareness.",
        link: "github.com/alexdev/shopstream",
        featured: true
      },
      {
        id: "p4",
        name: "DataLake Connect",
        tech: "Python, Spark, AWS Glue",
        tags: ["Python", "Data Engineering", "AWS", "Spark"],
        description: "ETL pipeline framework processing 5TB+ daily data for analytics.",
        longDescription: "A configuration-driven ETL framework that abstracts away the boilerplate of AWS Glue jobs, allowing data analysts to define pipelines using YAML.",
        challenges: "Optimizing Spark memory management for skewed datasets.",
        outcome: "Reduced pipeline development time from 2 weeks to 2 days.",
        link: "github.com/alexdev/datalake",
        featured: false
      },
      {
        id: "p5",
        name: "SecureAuth-SDK",
        tech: "TypeScript, Node.js",
        tags: ["Security", "TypeScript", "Node.js", "Auth"],
        description: "Authentication middleware used by 15+ internal microservices.",
        longDescription: "A standardized JWT validation and rotation library compliant with OAuth 2.1 standards.",
        challenges: "Maintaining backward compatibility while migrating from legacy token formats.",
        outcome: "Eliminated security vulnerabilities related to token handling across the organization.",
        link: "github.com/alexdev/secureauth",
        featured: false
      },
      {
        id: "p6",
        name: "KMP-Commons",
        tech: "Kotlin Multiplatform",
        tags: ["Mobile", "Kotlin", "KMP", "Android", "iOS"],
        description: "A shared utility library for Android and iOS networking logic.",
        longDescription: "Demonstrates the power of Kotlin Multiplatform by sharing 90% of business logic between native Android and iOS apps.",
        challenges: "Bridging Kotlin coroutines with Swift's async/await pattern seamlessly.",
        outcome: "Published on Maven Central; used in 3 production apps.",
        link: "github.com/alexdev/kmp-commons",
        featured: false
      }
    ],
    publications: [
      {
        id: "pub1",
        title: "Optimizing Distributed Ledger Latency in High-Frequency Trading Environments",
        conference: "IEEE International Conference on Blockchain",
        year: "2024",
        tags: ["Blockchain", "Distributed Systems", "Performance", "FinTech"],
        abstract: "This paper proposes a novel consensus mechanism tailored for high-frequency trading (HFT) environments where microsecond latency is critical. By introducing a 'Optimistic Pipeling' approach to block verification, we demonstrate a 40% reduction in commit latency compared to standard PBFT implementations.",
        link: "ieee.org/explore/...",
        featured: true
      },
      {
        id: "pub2",
        title: "A Comparative Analysis of Microservices vs. Monolithic Architectures in FinTech",
        conference: "Journal of Systems and Software",
        year: "2023",
        tags: ["Software Architecture", "Microservices", "FinTech"],
        abstract: "A longitudinal study of three major FinTech platform migrations. We analyze the trade-offs between operational complexity and development velocity, providing a decision framework for CTOs.",
        link: "sciencedirect.com/...",
        featured: true
      },
      {
        id: "pub3",
        title: "Leveraging Kotlin Multiplatform for Cross-Organizational Mobile Code Sharing",
        conference: "DroidCon SF",
        year: "2022",
        tags: ["Mobile", "KMP", "Software Engineering"],
        abstract: "Case study on adopting KMP in a large organization. We discuss the cultural and technical hurdles of sharing code between iOS and Android teams.",
        link: "droidcon.com/...",
        featured: true
      },
      {
        id: "pub4",
        title: "Consensus Algorithms in Low-Power IoT Networks",
        conference: "ACM IoT Conference",
        year: "2021",
        tags: ["IoT", "Blockchain", "Distributed Systems"],
        abstract: "Evaluating the energy efficiency of PoS vs PoW in battery-constrained IoT sensor networks.",
        link: "acm.org/...",
        featured: false
      },
      {
        id: "pub5",
        title: "Security Implications of Sharding in Blockchain",
        conference: "International Journal of Network Security",
        year: "2020",
        tags: ["Security", "Blockchain"],
        abstract: "An analysis of cross-shard attack vectors in proposed Ethereum 2.0 specifications.",
        link: "ijns.org/...",
        featured: false
      }
    ],
    education: [
      {
        degree: "Ph.D. in Computer Science (Distributed Systems)",
        school: "Stanford University",
        year: "2019 – 2023"
      },
      {
        degree: "M.S. in Computer Science",
        school: "Stanford University",
        year: "2017 – 2019"
      },
      {
        degree: "B.S. in Computer Science",
        school: "University of Technology",
        year: "2013 – 2017"
      }
    ],
    certifications: [
      { 
        name: "AWS Certified Solutions Architect – Assoc.", 
        issuer: "Amazon Web Services", 
        year: "2023",
        link: "https://aws.amazon.com/verification" 
      },
      { 
        name: "Certified Kubernetes Administrator (CKA)", 
        issuer: "CNCF", 
        year: "2023",
        link: "https://www.cncf.io/certification/cka/"
      },
      { name: "Oracle Certified Professional: Java SE", issuer: "Oracle", year: "2022", link: "#" },
      { name: "Microsoft Certified: Azure Developer", issuer: "Microsoft", year: "2022", link: "#" },
      { name: "Professional Cloud Architect", issuer: "Google Cloud", year: "2022", link: "#" },
      { name: "Certified ScrumMaster (CSM)", issuer: "Scrum Alliance", year: "2021", link: "#" },
      { name: "CompTIA Security+", issuer: "CompTIA", year: "2020", link: "#" },
      { name: "Meta Front-End Developer", issuer: "Meta", year: "2019", link: "#" }
    ],
    recommendations: [
      {
        text: "Alex is that rare combination of deep academic researcher and pragmatic engineer. He didn't just write papers about distributed systems; he built our core payments infrastructure that handles millions of transactions daily.",
        author: "Sarah Chen",
        role: "CTO, TechFlow Solutions"
      },
      {
        text: "During his Ph.D., Alex demonstrated an incredible ability to simplify complex concepts. His work on optimizing ledger latency is still being referenced by our research group today.",
        author: "Prof. Robert Smith",
        role: "Dept. of Computer Science, Stanford"
      },
      {
        text: "I worked with Alex on the CloudMonitor project. His code is clean, his architecture is sound, and he is always willing to mentor junior developers. A true 10x engineer.",
        author: "Michael Ross",
        role: "Principal Engineer, Innovate Corp"
      }
    ]
  };

  // --- ACTIONS ---
  const handleCopyEmail = () => {
    // Robust copy to clipboard
    const textArea = document.createElement("textarea");
    textArea.value = resumeData.header.email;
    document.body.appendChild(textArea);
    textArea.select();
    try {
      document.execCommand("copy");
      setEmailCopied(true);
      setTimeout(() => setEmailCopied(false), 2000);
    } catch (err) {
      console.error('Failed to copy text: ', err);
    }
    document.body.removeChild(textArea);
  };

  // --- EFFECT HOOKS FOR PAGINATION RESET ---
  useEffect(() => {
    setProjectsPage(1);
  }, [projectSearchQuery]);

  useEffect(() => {
    setResearchPage(1);
  }, [researchSearchQuery]);

  // --- SEARCH LOGIC ---
  const searchResults = useMemo(() => {
    if (!globalSearchQuery.trim()) return null;
    const query = globalSearchQuery.toLowerCase();

    const projects = resumeData.projects.filter(p => 
      p.name.toLowerCase().includes(query) || 
      p.description.toLowerCase().includes(query) ||
      p.tech.toLowerCase().includes(query) ||
      p.tags.some(t => t.toLowerCase().includes(query))
    );

    const publications = resumeData.publications.filter(p => 
      p.title.toLowerCase().includes(query) || 
      (p.abstract && p.abstract.toLowerCase().includes(query)) ||
      p.tags.some(t => t.toLowerCase().includes(query))
    );

    const experience = resumeData.experience.filter(e => 
      e.company.toLowerCase().includes(query) || 
      e.roles.some(r => r.title.toLowerCase().includes(query) || r.description.some(d => d.toLowerCase().includes(query)))
    );

    const skills = resumeData.skills.filter(s => 
      s.category.toLowerCase().includes(query) || 
      s.items.some(i => i.toLowerCase().includes(query))
    );

    return { projects, publications, experience, skills };
  }, [globalSearchQuery]);

  // --- NAVIGATION HELPERS ---
  const navigateToProject = (id) => {
    setDetailId(id);
    setCurrentView('project-detail');
    setIsSearchOpen(false);
    window.scrollTo(0, 0);
  };

  const navigateToResearch = (id) => {
    setDetailId(id);
    setCurrentView('research-detail');
    setIsSearchOpen(false);
    window.scrollTo(0, 0);
  };

  const navigateToView = (view) => {
    setCurrentView(view);
    setIsSearchOpen(false);
    window.scrollTo(0, 0);
  };

  // --- RELATED ITEMS LOGIC ---
  const getRelatedProjects = (currentId, tags) => {
    return resumeData.projects
      .filter(p => p.id !== currentId && p.tags.some(t => tags.includes(t)))
      .slice(0, 3);
  };

  const getRelatedPublications = (currentId, tags) => {
    return resumeData.publications
      .filter(p => p.id !== currentId && p.tags.some(t => tags.includes(t)))
      .slice(0, 3);
  };

  // --- COMPONENTS ---

  const ContactModal = () => {
    if (!isContactOpen) return null;

    return (
      <div className="fixed inset-0 z-[70] bg-slate-900/50 backdrop-blur-sm flex items-center justify-center p-4 animate-in fade-in duration-200">
        <div className="bg-white w-full max-w-md rounded-xl shadow-2xl overflow-hidden animate-in zoom-in-95 duration-200">
          <div className="flex justify-between items-center p-6 border-b border-slate-100">
            <h2 className="text-xl font-bold text-slate-900">Get in Touch</h2>
            <button onClick={() => setIsContactOpen(false)} className="text-slate-400 hover:text-slate-600 transition-colors">
              <X size={20} />
            </button>
          </div>
          
          <div className="p-6 space-y-6">
            <p className="text-slate-600 text-sm">
              I'm always open to discussing new opportunities, research collaborations, or just chatting about distributed systems.
            </p>

            {/* Email Option */}
            <div className="space-y-3">
              <div className="text-xs font-bold text-slate-400 uppercase tracking-wider">Email</div>
              <div className="flex gap-2">
                <div className="flex-grow p-3 bg-slate-50 border border-slate-200 rounded-lg text-slate-700 font-mono text-sm truncate">
                  {resumeData.header.email}
                </div>
                <button 
                  onClick={handleCopyEmail}
                  className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all ${emailCopied ? 'bg-green-100 text-green-700 border border-green-200' : 'bg-indigo-50 text-indigo-700 hover:bg-indigo-100 border border-indigo-200'}`}
                >
                  {emailCopied ? <Check size={18} /> : <Copy size={18} />}
                  {emailCopied ? 'Copied' : 'Copy'}
                </button>
              </div>
              <div className="text-center">
                <span className="text-xs text-slate-400">or</span>
              </div>
              <a 
                href={`mailto:${resumeData.header.email}`}
                className="block w-full py-2 text-center text-sm text-indigo-600 hover:text-indigo-800 font-medium"
              >
                Open in Email Client
              </a>
            </div>

            {/* LinkedIn Option */}
            <div className="space-y-3 pt-2 border-t border-slate-100">
              <div className="text-xs font-bold text-slate-400 uppercase tracking-wider">Social</div>
              <a 
                href={`https://${resumeData.header.linkedin}`} 
                target="_blank" 
                rel="noreferrer"
                className="flex items-center justify-between w-full p-4 bg-[#0077b5]/5 border border-[#0077b5]/20 rounded-xl hover:bg-[#0077b5]/10 transition-colors group"
              >
                <div className="flex items-center gap-3">
                  <Linkedin className="text-[#0077b5]" size={24} />
                  <span className="font-bold text-slate-700 group-hover:text-[#0077b5] transition-colors">Connect on LinkedIn</span>
                </div>
                <ExternalLink size={18} className="text-slate-400 group-hover:text-[#0077b5]" />
              </a>
            </div>
          </div>
        </div>
      </div>
    );
  };

  const PaginationControls = ({ currentPage, totalPages, onPageChange }) => {
    if (totalPages <= 1) return null;
    return (
      <div className="mt-12 flex justify-center items-center gap-4">
        <button 
          onClick={() => onPageChange(currentPage - 1)}
          disabled={currentPage === 1}
          className="p-2 border border-slate-200 rounded-lg hover:bg-slate-50 text-slate-600 disabled:opacity-30 disabled:cursor-not-allowed transition-colors"
        >
          <ChevronLeft size={20} />
        </button>
        <span className="text-sm font-medium text-slate-600">
          Page {currentPage} of {totalPages}
        </span>
        <button 
          onClick={() => onPageChange(currentPage + 1)}
          disabled={currentPage === totalPages}
          className="p-2 border border-slate-200 rounded-lg hover:bg-slate-50 text-slate-600 disabled:opacity-30 disabled:cursor-not-allowed transition-colors"
        >
          <ChevronRight size={20} />
        </button>
      </div>
    );
  };

  const GlobalSearch = () => {
    if (!isSearchOpen) return null;

    const hasResults = searchResults && (
      searchResults.projects.length > 0 || 
      searchResults.publications.length > 0 || 
      searchResults.experience.length > 0 || 
      searchResults.skills.length > 0
    );

    return (
      <div className="fixed inset-0 z-[60] bg-slate-900/50 backdrop-blur-sm flex items-start justify-center pt-20 px-4 animate-in fade-in duration-200">
        <div className="bg-white w-full max-w-2xl rounded-xl shadow-2xl overflow-hidden flex flex-col max-h-[80vh]">
          {/* Search Header */}
          <div className="p-4 border-b border-slate-100 flex items-center gap-3">
            <Search className="text-slate-400" size={20} />
            <input 
              type="text" 
              placeholder="Search projects, research, skills..." 
              className="flex-grow outline-none text-lg text-slate-800 placeholder:text-slate-400"
              autoFocus
              value={globalSearchQuery}
              onChange={(e) => setGlobalSearchQuery(e.target.value)}
            />
            <button onClick={() => setIsSearchOpen(false)} className="text-slate-400 hover:text-slate-600">
              <X size={20} />
            </button>
          </div>
          
          {/* Results Area */}
          <div className="overflow-y-auto p-4 bg-slate-50 flex-grow">
            {!globalSearchQuery.trim() ? (
               <div className="text-center text-slate-400 py-12 flex flex-col items-center gap-3">
                 <Search size={48} className="opacity-20" />
                 <p>Type to search across pages...</p>
               </div>
            ) : !hasResults ? (
               <div className="text-center text-slate-500 py-8">
                 No results found for "{globalSearchQuery}"
               </div>
            ) : (
               <div className="space-y-6">
                  {/* Projects Results */}
                  {searchResults.projects.length > 0 && (
                    <div>
                      <h3 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 px-2">Projects</h3>
                      <div className="space-y-2">
                        {searchResults.projects.map(p => (
                          <button key={p.id} onClick={() => navigateToProject(p.id)} className="w-full text-left p-3 bg-white hover:bg-indigo-50 rounded-lg border border-slate-200 hover:border-indigo-200 transition-all flex items-center gap-3 group">
                            <FolderGit size={18} className="text-slate-400 group-hover:text-indigo-600" />
                            <div>
                              <div className="font-bold text-slate-900 group-hover:text-indigo-700">{p.name}</div>
                              <div className="text-xs text-slate-500">{p.tech}</div>
                            </div>
                          </button>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* Publications Results */}
                  {searchResults.publications.length > 0 && (
                    <div>
                      <h3 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 px-2">Research</h3>
                      <div className="space-y-2">
                        {searchResults.publications.map(p => (
                          <button key={p.id} onClick={() => navigateToResearch(p.id)} className="w-full text-left p-3 bg-white hover:bg-indigo-50 rounded-lg border border-slate-200 hover:border-indigo-200 transition-all flex items-center gap-3 group">
                            <BookOpen size={18} className="text-slate-400 group-hover:text-indigo-600" />
                            <div>
                              <div className="font-bold text-slate-900 group-hover:text-indigo-700 truncate max-w-md">{p.title}</div>
                              <div className="text-xs text-slate-500">{p.conference} ({p.year})</div>
                            </div>
                          </button>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* Experience Results */}
                  {searchResults.experience.length > 0 && (
                    <div>
                      <h3 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 px-2">Experience</h3>
                      <div className="space-y-2">
                        {searchResults.experience.map((exp, idx) => (
                          <button key={idx} onClick={() => navigateToView('cv')} className="w-full text-left p-3 bg-white hover:bg-indigo-50 rounded-lg border border-slate-200 hover:border-indigo-200 transition-all flex items-center gap-3 group">
                            <Briefcase size={18} className="text-slate-400 group-hover:text-indigo-600" />
                            <div>
                              <div className="font-bold text-slate-900 group-hover:text-indigo-700">{exp.company}</div>
                              <div className="text-xs text-slate-500">{exp.roles[0].title}</div>
                            </div>
                          </button>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* Skills Results */}
                  {searchResults.skills.length > 0 && (
                    <div>
                      <h3 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 px-2">Skills</h3>
                      <div className="flex flex-wrap gap-2 px-2">
                        {searchResults.skills.flatMap(s => s.items).filter(i => i.toLowerCase().includes(globalSearchQuery.toLowerCase())).map((skill, idx) => (
                          <button key={idx} onClick={() => navigateToView('cv')} className="px-2 py-1 bg-white hover:bg-indigo-100 border border-slate-200 rounded text-sm text-slate-700 hover:text-indigo-800 transition-colors">
                            {skill}
                          </button>
                        ))}
                      </div>
                    </div>
                  )}
               </div>
            )}
          </div>
        </div>
      </div>
    );
  };

  const Navbar = () => (
    <nav className="sticky top-0 z-50 bg-slate-900 text-white shadow-lg print:hidden">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="flex justify-between h-16 items-center">
          <div className="flex items-center cursor-pointer" onClick={() => setCurrentView('home')}>
            <span className="font-bold text-xl tracking-tight">Alex<span className="text-indigo-400">Dev</span></span>
          </div>
          
          <div className="flex items-center gap-4">
            {/* Desktop Menu */}
            <div className="hidden md:flex items-center space-x-8">
              {['Home', 'Projects', 'Research', 'CV'].map((item) => {
                const viewName = item.toLowerCase() === 'cv' ? 'cv' : item.toLowerCase();
                const isActive = currentView === viewName || 
                               (currentView === 'project-detail' && viewName === 'projects') ||
                               (currentView === 'research-detail' && viewName === 'research');
                return (
                  <button 
                    key={item}
                    onClick={() => setCurrentView(viewName)} 
                    className={`text-sm font-medium transition-colors hover:text-indigo-300 ${isActive ? 'text-white' : 'text-slate-400'}`}
                  >
                    {item === 'CV' ? 'Resume / CV' : item}
                  </button>
                );
              })}
            </div>

            <div className="flex items-center gap-3">
              {/* Search Trigger */}
              <button 
                onClick={() => setIsSearchOpen(true)}
                className="p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-full transition-all"
                title="Search (Cmd+K)"
              >
                <Search size={20} />
              </button>

              <button 
                onClick={() => setIsContactOpen(true)}
                className="hidden md:block px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium rounded-md transition-colors"
              >
                Contact
              </button>

              {/* Mobile Menu Button */}
              <div className="md:hidden">
                <button onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)} className="text-slate-300 hover:text-white">
                  {isMobileMenuOpen ? <X size={24} /> : <Menu size={24} />}
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      {isMobileMenuOpen && (
        <div className="md:hidden bg-slate-800 border-t border-slate-700">
          <div className="px-2 pt-2 pb-3 space-y-1 sm:px-3">
             {['Home', 'Projects', 'Research', 'CV'].map((item) => {
              const viewName = item.toLowerCase() === 'cv' ? 'cv' : item.toLowerCase();
              return (
                <button 
                  key={item}
                  onClick={() => { setCurrentView(viewName); setIsMobileMenuOpen(false); }}
                  className={`block w-full text-left px-3 py-2 rounded-md text-base font-medium ${currentView === viewName ? 'bg-slate-900 text-white' : 'text-slate-300 hover:bg-slate-700 hover:text-white'}`}
                >
                  {item === 'CV' ? 'Resume / CV' : item}
                </button>
              );
            })}
            {/* Mobile Contact Button */}
            <button 
                onClick={() => { setIsContactOpen(true); setIsMobileMenuOpen(false); }}
                className="block w-full text-left px-3 py-2 rounded-md text-base font-medium text-indigo-400 hover:bg-slate-700 hover:text-white"
              >
                Contact Me
            </button>
          </div>
        </div>
      )}
    </nav>
  );

  const Footer = () => (
    <footer className="bg-slate-900 text-slate-400 py-6 border-t border-slate-800 print:hidden mt-auto">
      <div className="max-w-7xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-4">
        <div className="flex items-center gap-2 text-sm">
          <span className="font-bold text-white tracking-tight">Alex<span className="text-indigo-400">Dev</span></span>
          <span>© {new Date().getFullYear()}</span>
        </div>
        <div className="flex gap-4">
          <a href={`https://${resumeData.header.linkedin}`} target="_blank" rel="noreferrer" className="hover:text-white transition-colors"><Linkedin size={18} /></a>
          <a href={`https://${resumeData.header.github}`} target="_blank" rel="noreferrer" className="hover:text-white transition-colors"><Github size={18} /></a>
          <button onClick={() => setIsContactOpen(true)} className="hover:text-white transition-colors"><Mail size={18} /></button>
        </div>
      </div>
    </footer>
  );

  const HomeView = () => (
    <div className="animate-in fade-in duration-500">
      <div className="bg-slate-900 text-white pt-20 pb-24 md:pt-32 md:pb-40 px-4">
        <div className="max-w-5xl mx-auto text-center">
          <h1 className="text-4xl md:text-6xl font-extrabold tracking-tight mb-6">
            Hi, I'm <span className="text-indigo-400">{resumeData.header.name}</span>
          </h1>
          <p className="text-xl md:text-2xl text-slate-300 max-w-3xl mx-auto mb-10 leading-relaxed">
            {resumeData.header.title} specializing in distributed systems and scalable enterprise architecture.
          </p>
          <div className="flex flex-col sm:flex-row gap-4 justify-center">
            <button onClick={() => setCurrentView('cv')} className="px-8 py-4 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-lg transition-all flex items-center justify-center gap-2">
              View Full CV <ArrowRight size={20} />
            </button>
            <button onClick={() => setIsContactOpen(true)} className="px-8 py-4 bg-transparent border-2 border-slate-600 hover:border-white text-white font-bold rounded-lg transition-all flex items-center justify-center gap-2">
              Get In Touch <Mail size={20} />
            </button>
          </div>
        </div>
      </div>

      <div className="bg-white py-20 px-4">
        <div className="max-w-7xl mx-auto">
          <div className="text-center mb-16">
            <h2 className="text-3xl font-bold text-slate-900">Career Highlights</h2>
            <div className="w-20 h-1 bg-indigo-500 mx-auto mt-4"></div>
          </div>
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
            <div className="p-8 bg-slate-50 rounded-xl border border-slate-100 shadow-sm hover:shadow-md transition-shadow">
              <div className="w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center mb-6">
                <BookOpen className="text-indigo-600" size={24} />
              </div>
              <h3 className="text-xl font-bold text-slate-900 mb-3">Academic Excellence</h3>
              <p className="text-slate-600 leading-relaxed text-sm">
                Ph.D. in Distributed Systems from Stanford University. Published author in IEEE and top-tier journals.
              </p>
            </div>
            <div className="p-8 bg-slate-50 rounded-xl border border-slate-100 shadow-sm hover:shadow-md transition-shadow">
              <div className="w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center mb-6">
                <Cpu className="text-indigo-600" size={24} />
              </div>
              <h3 className="text-xl font-bold text-slate-900 mb-3">Full-Stack Expertise</h3>
              <p className="text-slate-600 leading-relaxed text-sm">
                Deep expertise in Java, .NET, and Python ecosystems. Architecting complex backends and intuitive frontends.
              </p>
            </div>
            <div className="p-8 bg-slate-50 rounded-xl border border-slate-100 shadow-sm hover:shadow-md transition-shadow">
              <div className="w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center mb-6">
                <Bot className="text-indigo-600" size={24} />
              </div>
              <h3 className="text-xl font-bold text-slate-900 mb-3">AI & Agentic Systems</h3>
              <p className="text-slate-600 leading-relaxed text-sm">
                At the forefront of AI-assisted engineering. Skilled in developing autonomous agents using Pydantic, Semantic Kernel, and modern LLM orchestration patterns.
              </p>
            </div>
            <div className="p-8 bg-slate-50 rounded-xl border border-slate-100 shadow-sm hover:shadow-md transition-shadow">
              <div className="w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center mb-6">
                <Award className="text-indigo-600" size={24} />
              </div>
              <h3 className="text-xl font-bold text-slate-900 mb-3">Certified Professional</h3>
              <p className="text-slate-600 leading-relaxed text-sm">
                Holder of 8+ industry certifications including AWS Solutions Architect, CKA (Kubernetes), and Google Cloud Architect.
              </p>
            </div>
          </div>
        </div>
      </div>

      <div className="bg-slate-50 py-20 px-4">
        <div className="max-w-7xl mx-auto">
          <div className="flex flex-col md:flex-row justify-between items-end mb-12 gap-4">
            <div>
              <h2 className="text-3xl font-bold text-slate-900">Featured Projects</h2>
              <div className="w-20 h-1 bg-indigo-500 mt-4"></div>
            </div>
            <button onClick={() => setCurrentView('projects')} className="text-indigo-600 font-bold hover:text-indigo-800 flex items-center gap-1 group">
              View All Projects <ChevronRight size={20} className="transform group-hover:translate-x-1 transition-transform"/>
            </button>
          </div>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
            {resumeData.projects.filter(p => p.featured).slice(0, 3).map((project, index) => (
              <div key={index} onClick={() => navigateToProject(project.id)} className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm hover:shadow-md transition-all hover:-translate-y-1 cursor-pointer group">
                <div className="flex justify-between items-start mb-3">
                   <FolderGit size={24} className="text-indigo-600 group-hover:scale-110 transition-transform" />
                </div>
                <h3 className="font-bold text-slate-900 text-lg mb-2 group-hover:text-indigo-600 transition-colors">{project.name}</h3>
                <p className="text-xs font-bold text-indigo-600 font-mono mb-3">{project.tech}</p>
                <p className="text-slate-600 text-sm leading-relaxed mb-4 line-clamp-3">{project.description}</p>
              </div>
            ))}
          </div>
        </div>
      </div>

      <div className="bg-white py-20 px-4">
        <div className="max-w-7xl mx-auto">
          <div className="flex flex-col md:flex-row justify-between items-end mb-12 gap-4">
            <div>
              <h2 className="text-3xl font-bold text-slate-900">Selected Research</h2>
              <div className="w-20 h-1 bg-indigo-500 mt-4"></div>
            </div>
            <button onClick={() => setCurrentView('research')} className="text-indigo-600 font-bold hover:text-indigo-800 flex items-center gap-1 group">
              View All Publications <ChevronRight size={20} className="transform group-hover:translate-x-1 transition-transform"/>
            </button>
          </div>
          <div className="space-y-4">
            {resumeData.publications.filter(p => p.featured).slice(0, 3).map((pub, index) => (
               <div key={index} onClick={() => navigateToResearch(pub.id)} className="flex flex-col md:flex-row justify-between items-start md:items-center p-6 bg-slate-50 rounded-xl border border-slate-100 hover:border-indigo-200 transition-colors cursor-pointer group">
                <div className="flex-grow pr-4">
                  <h3 className="font-bold text-slate-900 text-lg mb-1 group-hover:text-indigo-600 transition-colors">{pub.title}</h3>
                  <div className="flex items-center gap-2 text-slate-600 text-sm italic">
                    <BookOpen size={16} />
                    <span>{pub.conference}</span>
                  </div>
                </div>
                <div className="mt-4 md:mt-0 flex items-center gap-4 min-w-fit">
                  <span className="font-bold text-slate-400">{pub.year}</span>
                  <span className="text-indigo-600 font-medium text-sm flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                    View Details <ChevronRight size={16} />
                  </span>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  );

  const ProjectDetailView = () => {
    const project = resumeData.projects.find(p => p.id === detailId);
    if (!project) return <div>Project not found</div>;
    const relatedProjects = getRelatedProjects(project.id, project.tags);

    return (
      <div className="min-h-screen bg-slate-50 animate-in fade-in duration-500 pb-20">
         {/* Header */}
        <div className="bg-slate-900 text-white pt-12 pb-24 px-4">
           <div className="max-w-4xl mx-auto">
              <button onClick={() => setCurrentView('projects')} className="text-indigo-300 hover:text-white flex items-center gap-2 mb-6 font-medium transition-colors">
                <ArrowLeft size={20} /> Back to Projects
              </button>
              <h1 className="text-3xl md:text-5xl font-extrabold mb-4">{project.name}</h1>
              <div className="flex flex-wrap gap-4 items-center">
                 <div className="flex items-center gap-2 text-slate-300">
                    <FolderGit size={20} />
                    <span className="font-mono">{project.tech}</span>
                 </div>
                 {project.link && (
                    <a href={`https://${project.link}`} target="_blank" rel="noreferrer" className="flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 rounded-full text-sm font-bold transition-colors">
                       <Github size={16} /> View Code
                    </a>
                 )}
              </div>
           </div>
        </div>

        {/* Content */}
        <div className="max-w-4xl mx-auto px-4 -mt-16">
           <div className="bg-white rounded-xl shadow-xl p-8 md:p-12 border border-slate-100">
              <div className="prose max-w-none text-slate-700">
                 <h2 className="text-2xl font-bold text-slate-900 mb-4 flex items-center gap-2">
                    <FileText className="text-indigo-600"/> Overview
                 </h2>
                 <p className="text-lg leading-relaxed mb-8">{project.longDescription}</p>

                 <div className="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                    <div className="bg-slate-50 p-6 rounded-lg border-l-4 border-indigo-500">
                       <h3 className="font-bold text-slate-900 mb-2">The Challenge</h3>
                       <p className="text-sm">{project.challenges}</p>
                    </div>
                    <div className="bg-slate-50 p-6 rounded-lg border-l-4 border-emerald-500">
                       <h3 className="font-bold text-slate-900 mb-2">The Outcome</h3>
                       <p className="text-sm">{project.outcome}</p>
                    </div>
                 </div>

                 <h3 className="text-xl font-bold text-slate-900 mb-4">Technologies & Concepts</h3>
                 <div className="flex flex-wrap gap-2 mb-8">
                    {project.tags.map((tag, i) => (
                       <span key={i} className="px-3 py-1 bg-slate-100 text-slate-700 rounded-full text-sm font-medium">
                          {tag}
                       </span>
                    ))}
                 </div>
              </div>
           </div>

           {/* Related Projects */}
           {relatedProjects.length > 0 && (
             <div className="mt-16">
                <h3 className="text-2xl font-bold text-slate-900 mb-6">Related Projects</h3>
                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                   {relatedProjects.map((rp, i) => (
                      <div key={i} onClick={() => navigateToProject(rp.id)} className="bg-white p-6 rounded-xl border border-slate-200 hover:border-indigo-300 hover:-translate-y-1 transition-all cursor-pointer">
                         <h4 className="font-bold text-slate-900 mb-2">{rp.name}</h4>
                         <p className="text-xs text-indigo-600 font-mono mb-2">{rp.tech}</p>
                         <p className="text-sm text-slate-600 line-clamp-2">{rp.description}</p>
                      </div>
                   ))}
                </div>
             </div>
           )}
        </div>
      </div>
    );
  };

  const ResearchDetailView = () => {
    const pub = resumeData.publications.find(p => p.id === detailId);
    if (!pub) return <div>Publication not found</div>;
    const relatedPubs = getRelatedPublications(pub.id, pub.tags);

    return (
      <div className="min-h-screen bg-slate-50 animate-in fade-in duration-500 pb-20">
         {/* Header */}
        <div className="bg-slate-900 text-white pt-12 pb-24 px-4">
           <div className="max-w-4xl mx-auto">
              <button onClick={() => setCurrentView('research')} className="text-indigo-300 hover:text-white flex items-center gap-2 mb-6 font-medium transition-colors">
                <ArrowLeft size={20} /> Back to Research
              </button>
              <h1 className="text-2xl md:text-4xl font-extrabold mb-4 leading-tight">{pub.title}</h1>
              <div className="flex flex-wrap gap-6 items-center text-slate-300 text-sm md:text-base">
                 <div className="flex items-center gap-2">
                    <Calendar size={18} />
                    <span>{pub.year}</span>
                 </div>
                 <div className="flex items-center gap-2">
                    <BookOpen size={18} />
                    <span className="italic">{pub.conference}</span>
                 </div>
              </div>
           </div>
        </div>

        {/* Content */}
        <div className="max-w-4xl mx-auto px-4 -mt-16">
           <div className="bg-white rounded-xl shadow-xl p-8 md:p-12 border border-slate-100">
              <div className="mb-8">
                 <h2 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Abstract</h2>
                 <p className="text-lg leading-relaxed text-slate-800 italic border-l-4 border-indigo-100 pl-6 py-2">
                    {pub.abstract}
                 </p>
              </div>

              <div className="mb-8">
                 <h2 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-4">Topics</h2>
                 <div className="flex flex-wrap gap-2">
                    {pub.tags.map((tag, i) => (
                       <span key={i} className="px-3 py-1 bg-indigo-50 text-indigo-700 rounded text-sm font-medium">
                          {tag}
                       </span>
                    ))}
                 </div>
              </div>

              <div className="flex gap-4 pt-6 border-t border-slate-100">
                 <a href={`https://${pub.link}`} target="_blank" rel="noreferrer" className="flex items-center gap-2 px-6 py-3 bg-slate-900 text-white rounded-lg hover:bg-slate-800 transition-colors font-bold">
                    <ExternalLink size={18} /> Read Full Paper
                 </a>
                 <button className="flex items-center gap-2 px-6 py-3 border border-slate-200 text-slate-600 rounded-lg hover:bg-slate-50 transition-colors font-medium">
                    <Quote size={18} /> Cite
                 </button>
              </div>
           </div>

           {/* Related Research */}
           {relatedPubs.length > 0 && (
             <div className="mt-16">
                <h3 className="text-2xl font-bold text-slate-900 mb-6">Related Publications</h3>
                <div className="space-y-4">
                   {relatedPubs.map((rp, i) => (
                      <div key={i} onClick={() => navigateToResearch(rp.id)} className="bg-white p-6 rounded-xl border border-slate-200 hover:border-indigo-300 hover:shadow-md transition-all cursor-pointer">
                         <h4 className="font-bold text-slate-900 text-lg mb-1">{rp.title}</h4>
                         <div className="flex justify-between items-center text-sm text-slate-500">
                            <span>{rp.conference}</span>
                            <span>{rp.year}</span>
                         </div>
                      </div>
                   ))}
                </div>
             </div>
           )}
        </div>
      </div>
    );
  };

  const ProjectsView = () => {
    // Search filtering
    const filteredProjects = resumeData.projects.filter(p => 
      p.name.toLowerCase().includes(projectSearchQuery.toLowerCase()) || 
      p.tech.toLowerCase().includes(projectSearchQuery.toLowerCase()) ||
      p.tags.some(t => t.toLowerCase().includes(projectSearchQuery.toLowerCase()))
    );

    // Pagination Logic
    const totalPages = Math.ceil(filteredProjects.length / ITEMS_PER_PAGE);
    const paginatedProjects = filteredProjects.slice(
      (projectsPage - 1) * ITEMS_PER_PAGE, 
      projectsPage * ITEMS_PER_PAGE
    );

    return (
      <div className="min-h-screen bg-slate-50 animate-in fade-in duration-500 py-12 px-4 md:px-8">
        <div className="max-w-4xl mx-auto">
          <div className="mb-12 text-center md:text-left">
             <h1 className="text-4xl font-extrabold text-slate-900 mb-4">Engineering Portfolio</h1>
             <p className="text-xl text-slate-600 max-w-2xl mb-8">A comprehensive list of my engineering projects, open-source contributions, and architectural experiments.</p>
             
             {/* Search Bar */}
             <div className="relative max-w-md">
                <Search className="absolute left-3 top-3 text-slate-400" size={20} />
                <input 
                  type="text" 
                  placeholder="Filter projects by tech, name, or tag..." 
                  className="w-full pl-10 pr-4 py-3 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-shadow shadow-sm"
                  value={projectSearchQuery}
                  onChange={(e) => setProjectSearchQuery(e.target.value)}
                />
             </div>
          </div>
  
          {filteredProjects.length > 0 ? (
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              {paginatedProjects.map((project, index) => (
                <div key={index} onClick={() => navigateToProject(project.id)} className="flex flex-col bg-white rounded-xl border border-slate-200 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all cursor-pointer overflow-hidden group">
                   <div className="h-2 bg-indigo-500 w-full group-hover:bg-indigo-600 transition-colors"></div>
                   <div className="p-6 flex flex-col flex-grow">
                      <div className="flex justify-between items-start mb-4">
                         <FolderGit size={32} className="text-slate-700 group-hover:text-indigo-600 transition-colors" />
                         <span className="p-2 bg-slate-50 rounded-full text-slate-400">
                            <ExternalLink size={20} />
                          </span>
                      </div>
                      <h3 className="font-bold text-slate-900 text-xl mb-2 group-hover:text-indigo-600 transition-colors">{project.name}</h3>
                      <div className="mb-4">
                         <span className="inline-block bg-indigo-50 text-indigo-700 text-xs font-bold px-2 py-1 rounded border border-indigo-100 font-mono">
                            {project.tech}
                         </span>
                      </div>
                      <p className="text-slate-600 text-sm leading-relaxed flex-grow line-clamp-3">{project.description}</p>
                      <div className="mt-4 pt-4 border-t border-slate-50 flex flex-wrap gap-2">
                         {project.tags.slice(0, 3).map((tag, i) => (
                            <span key={i} className="text-xs text-slate-500 bg-slate-100 px-2 py-1 rounded flex items-center gap-1">
                               <Tag size={10} /> {tag}
                            </span>
                         ))}
                         {project.tags.length > 3 && <span className="text-xs text-slate-400 py-1">+{project.tags.length - 3} more</span>}
                      </div>
                   </div>
                </div>
              ))}
            </div>
          ) : (
            <div className="text-center py-20 text-slate-500">
              No projects found matching your criteria.
            </div>
          )}

          <PaginationControls 
            currentPage={projectsPage} 
            totalPages={totalPages} 
            onPageChange={setProjectsPage} 
          />
          
          <div className="mt-16 text-center">
             <button onClick={() => setCurrentView('home')} className="text-indigo-600 font-bold hover:underline">
               &larr; Back to Home
             </button>
          </div>
        </div>
      </div>
    );
  };

  const ResearchView = () => {
    // Search filtering
    const filteredPubs = resumeData.publications.filter(p => 
      p.title.toLowerCase().includes(researchSearchQuery.toLowerCase()) || 
      p.conference.toLowerCase().includes(researchSearchQuery.toLowerCase()) ||
      p.tags.some(t => t.toLowerCase().includes(researchSearchQuery.toLowerCase()))
    );

    // Pagination Logic
    const totalPages = Math.ceil(filteredPubs.length / ITEMS_PER_PAGE);
    const paginatedPubs = filteredPubs.slice(
      (researchPage - 1) * ITEMS_PER_PAGE, 
      researchPage * ITEMS_PER_PAGE
    );

    return (
      <div className="min-h-screen bg-slate-50 animate-in fade-in duration-500 py-12 px-4 md:px-8">
       <div className="max-w-4xl mx-auto">
        <div className="mb-12 text-center md:text-left">
           <h1 className="text-4xl font-extrabold text-slate-900 mb-4">Research Publications</h1>
           <p className="text-xl text-slate-600 max-w-2xl mb-8">Selected academic papers, journals, and conference proceedings in distributed systems and software architecture.</p>
           
           {/* Search Bar */}
           <div className="relative max-w-md mx-auto md:mx-0">
              <Search className="absolute left-3 top-3 text-slate-400" size={20} />
              <input 
                type="text" 
                placeholder="Filter research by title, topic, or venue..." 
                className="w-full pl-10 pr-4 py-3 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-shadow shadow-sm"
                value={researchSearchQuery}
                onChange={(e) => setResearchSearchQuery(e.target.value)}
              />
           </div>
        </div>

        {filteredPubs.length > 0 ? (
          <div className="space-y-6">
            {paginatedPubs.map((pub, index) => (
              <div key={index} onClick={() => navigateToResearch(pub.id)} className="bg-white p-8 rounded-xl border border-slate-200 shadow-sm hover:shadow-md hover:border-indigo-300 transition-all cursor-pointer group flex flex-col">
                 <div className="flex flex-col sm:flex-row gap-6">
                    <div className="flex-shrink-0">
                       <div className="w-16 h-16 bg-indigo-50 group-hover:bg-indigo-100 rounded-lg flex items-center justify-center text-indigo-700 font-bold text-xl border border-indigo-100 transition-colors">
                          {pub.year}
                       </div>
                    </div>
                    <div className="flex-grow">
                       <div className="flex justify-between items-start">
                          <h3 className="text-xl font-bold text-slate-900 mb-2 leading-tight group-hover:text-indigo-600 transition-colors">{pub.title}</h3>
                          <ExternalLink size={18} className="text-slate-300 group-hover:text-indigo-400 flex-shrink-0 ml-2" />
                       </div>
                       <p className="text-slate-600 italic mb-4 flex items-center gap-2 text-sm">
                          <BookOpen size={16} className="flex-shrink-0" /> {pub.conference}
                       </p>
                       <p className="text-slate-500 text-sm mb-4 line-clamp-3 leading-relaxed">
                          {pub.abstract}
                       </p>
                       <div className="flex flex-wrap gap-2 mt-auto">
                          {pub.tags.slice(0, 4).map((tag, i) => (
                             <span key={i} className="px-2 py-1 bg-slate-100 text-slate-600 text-xs rounded font-medium border border-slate-200">
                                {tag}
                             </span>
                          ))}
                          {pub.tags.length > 4 && (
                            <span className="px-2 py-1 text-slate-400 text-xs font-medium">+{pub.tags.length - 4}</span>
                          )}
                       </div>
                    </div>
                 </div>
              </div>
            ))}
          </div>
        ) : (
          <div className="text-center py-20 text-slate-500">
            No publications found matching your criteria.
          </div>
        )}

        <PaginationControls 
          currentPage={researchPage} 
          totalPages={totalPages} 
          onPageChange={setResearchPage} 
        />

        <div className="mt-16 text-center">
           <button onClick={() => setCurrentView('home')} className="text-indigo-600 font-bold hover:underline">
             &larr; Back to Home
           </button>
        </div>
      </div>
    </div>
    );
  };

  const CVView = () => (
    <div className="bg-white p-4 md:p-8 animate-in slide-in-from-bottom-4 duration-500 print:p-0">
      
      {/* Floating Print Button - Visible only on screen */}
      <button 
        onClick={() => window.print()}
        className="fixed bottom-8 right-8 z-50 flex items-center gap-2 px-6 py-3 bg-indigo-600 text-white rounded-full shadow-lg hover:bg-indigo-700 hover:shadow-xl transition-all transform hover:-translate-y-1 print:hidden font-bold"
        title="Print or Save as PDF"
      >
        <Printer size={20} />
        <span className="hidden md:inline">Print CV</span>
      </button>

      <div className="max-w-[210mm] mx-auto bg-white shadow-2xl overflow-hidden print:shadow-none print:max-w-none print:m-0 flex flex-col min-h-[297mm]">
        
        {/* HEADER */}
        <header className="bg-slate-900 text-white p-8 md:p-10 print:bg-slate-900 print:text-white">
          <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-6">
            <div>
              <h1 className="text-4xl font-bold tracking-tight">{resumeData.header.name}</h1>
              <p className="text-xl text-slate-300 font-medium mt-1">{resumeData.header.title}</p>
            </div>
            
            <div className="flex flex-col gap-2 text-sm text-slate-300">
              <div className="flex items-center gap-2">
                <MapPin size={16} />
                <span>{resumeData.header.location}</span>
              </div>
              <div className="flex items-center gap-2">
                <Mail size={16} />
                <a href={`mailto:${resumeData.header.email}`} className="hover:text-white transition-colors">{resumeData.header.email}</a>
              </div>
              <div className="flex items-center gap-2">
                <Phone size={16} />
                <span>{resumeData.header.phone}</span>
              </div>
              <div className="flex gap-4 mt-2 print:text-black">
                {/* LinkedIn */}
                <a href={`https://${resumeData.header.linkedin}`} target="_blank" rel="noreferrer" className="text-slate-300 hover:text-white transition-colors flex items-center gap-1">
                  <Linkedin size={20} className="print:hidden"/>
                  <span className="hidden print:inline text-xs">{resumeData.header.linkedin}</span>
                </a>
                {/* Github */}
                <a href={`https://${resumeData.header.github}`} target="_blank" rel="noreferrer" className="text-slate-300 hover:text-white transition-colors flex items-center gap-1">
                  <Github size={20} className="print:hidden"/>
                   <span className="hidden print:inline text-xs">{resumeData.header.github}</span>
                </a>
                {/* Website */}
                <a href={`https://${resumeData.header.website}`} target="_blank" rel="noreferrer" className="text-slate-300 hover:text-white transition-colors flex items-center gap-1">
                  <Globe size={20} className="print:hidden"/>
                   <span className="hidden print:inline text-xs">{resumeData.header.website}</span>
                </a>
              </div>
            </div>
          </div>

          <div className="mt-8 border-t border-slate-700 pt-6">
            <p className="text-slate-300 leading-relaxed max-w-3xl">
              {resumeData.header.summary}
            </p>
          </div>
        </header>

        {/* MAIN BODY: Experience (Left) & Skills (Right) */}
        <div className="flex flex-col md:flex-row flex-grow">
          
          {/* LEFT COLUMN: Experience ONLY */}
          <div className="w-full md:w-2/3 p-8 md:p-10 pr-4 md:pr-12 bg-white">
            <section>
              <h2 className="text-xl font-bold text-slate-900 border-b-2 border-slate-300 pb-2 mb-6 flex items-center gap-2">
                <Briefcase size={20} className="text-slate-700" /> Experience
              </h2>
              <div className="space-y-8">
                {resumeData.experience.map((companyData, index) => (
                  <div key={index} className="relative pl-4 border-l-2 border-slate-300 transition-colors duration-300">
                    <div className="flex justify-between items-baseline mb-4">
                      <div className="text-xl font-bold text-slate-900">{companyData.company}</div>
                      <span className="text-xs font-bold text-slate-600 bg-slate-100 px-2 py-1 rounded border border-slate-300">{companyData.period}</span>
                    </div>
                    <div className="space-y-6">
                      {companyData.roles.map((role, rIndex) => (
                        <div key={rIndex} className="relative">
                          {companyData.roles.length > 1 && (
                            <div className="absolute -left-[21px] top-2 w-2.5 h-2.5 rounded-full bg-slate-400 border-2 border-white"></div>
                          )}
                          <div className="flex flex-col sm:flex-row sm:justify-between sm:items-baseline mb-2">
                            <h3 className="text-lg font-bold text-slate-800">{role.title}</h3>
                            <span className="text-sm font-medium text-slate-500">{role.period}</span>
                          </div>
                          <ul className="list-disc list-outside ml-4 space-y-1.5 text-slate-700 text-sm leading-relaxed">
                            {role.description.map((point, idx) => (
                              <li key={idx}>{point}</li>
                            ))}
                          </ul>
                        </div>
                      ))}
                    </div>
                  </div>
                ))}
              </div>
            </section>
          </div>

          {/* RIGHT COLUMN: Skills ONLY */}
          <div className="w-full md:w-1/3 bg-slate-50 p-8 md:p-10 border-l border-slate-200">
            <section>
              <h2 className="text-xl font-bold text-slate-900 border-b-2 border-slate-300 pb-2 mb-6 flex items-center gap-2">
                <Cpu size={20} className="text-slate-700" /> Technical Skills
              </h2>
              <div className="space-y-5">
                {resumeData.skills.map((skillGroup, idx) => (
                  <div key={idx}>
                    <h3 className="text-sm font-bold text-slate-900 uppercase tracking-wider mb-2 border-l-4 border-slate-700 pl-3">
                      {skillGroup.category}
                    </h3>
                    <div className="flex flex-wrap gap-1.5 pl-1">
                      {skillGroup.items.map((item, i) => (
                        <span key={i} className="px-2 py-0.5 bg-white border border-slate-300 text-slate-800 text-xs font-bold rounded-md shadow-sm">
                          {item}
                        </span>
                      ))}
                    </div>
                  </div>
                ))}
              </div>
            </section>
          </div>
        </div>

        {/* FULL WIDTH PROJECTS SECTION */}
        <div className="px-8 md:px-10 pb-6 bg-white">
           <h2 className="text-xl font-bold text-slate-900 border-b-2 border-slate-300 pb-2 mb-6 flex items-center gap-2">
              <FolderGit size={20} className="text-slate-700" /> Key Projects
            </h2>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              {resumeData.projects.filter(p => p.featured).slice(0,3).map((project, index) => (
                <div key={index} className="bg-slate-50 p-4 rounded-lg border border-slate-200 hover:border-slate-400 transition-colors">
                  <div className="flex justify-between items-start mb-2">
                    <h3 className="font-bold text-slate-900">{project.name}</h3>
                    <a href={`https://${project.link}`} target="_blank" rel="noreferrer" className="text-slate-600 hover:text-slate-900 print:hidden">
                      <ExternalLink size={16} />
                    </a>
                  </div>
                  <p className="text-xs font-bold text-slate-700 font-mono mb-2">{project.tech}</p>
                  <p className="text-sm text-slate-600 leading-snug">{project.description}</p>
                </div>
              ))}
            </div>
        </div>

        {/* FULL WIDTH PUBLICATIONS SECTION */}
        <div className="px-8 md:px-10 pb-10 bg-white">
           <h2 className="text-xl font-bold text-slate-900 border-b-2 border-slate-300 pb-2 mb-6 flex items-center gap-2">
              <BookOpen size={20} className="text-slate-700" /> Publications & Research
            </h2>
            <div className="grid grid-cols-1 gap-3">
              {resumeData.publications.filter(p => p.featured).slice(0, 3).map((pub, index) => (
                <div key={index} className="flex flex-col md:flex-row md:justify-between md:items-baseline border-b border-slate-100 last:border-0 pb-3 last:pb-0 hover:bg-slate-50 transition-colors p-2 rounded">
                  <div className="flex-grow">
                    <a href={`https://${pub.link}`} target="_blank" rel="noreferrer" className="font-bold text-slate-900 hover:underline decoration-slate-400 underline-offset-4">
                      {pub.title}
                    </a>
                    <div className="text-sm text-slate-600 mt-1 italic">
                      {pub.conference}
                    </div>
                  </div>
                  <div className="mt-2 md:mt-0 md:ml-6 text-sm font-bold text-slate-500 whitespace-nowrap">
                    {pub.year}
                  </div>
                </div>
              ))}
            </div>
        </div>

        {/* FOOTER SECTION: Education & Certifications */}
        <div className="bg-slate-50 p-8 md:p-10 border-t border-slate-200">
          <div className="grid grid-cols-1 md:grid-cols-12 gap-10">
            
            {/* EDUCATION */}
            <div className="md:col-span-4">
              <h2 className="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2">
                <GraduationCap size={20} className="text-slate-700" /> Education
              </h2>
              <div className="space-y-4">
                {resumeData.education.map((edu, index) => (
                  <div key={index}>
                    <h3 className="font-bold text-slate-900 text-sm leading-tight">{edu.degree}</h3>
                    <div className="text-xs text-slate-700 font-medium mt-1">{edu.school}</div>
                    <div className="text-xs text-slate-500 mt-0.5">{edu.year}</div>
                  </div>
                ))}
              </div>
            </div>

            {/* CERTIFICATIONS */}
            <div className="md:col-span-8">
              <h2 className="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2">
                <Award size={20} className="text-slate-700" /> Certifications
              </h2>
              <div className="grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-4">
                {resumeData.certifications.map((cert, index) => (
                  <div key={index} className="flex flex-col text-sm border-l-2 border-slate-300 pl-3 hover:border-slate-500 transition-colors">
                     <a 
                        href={cert.link} 
                        target="_blank" 
                        rel="noreferrer"
                        className="font-semibold text-slate-800 hover:text-black transition-colors leading-tight mb-1"
                        title={cert.name}
                      >
                        {cert.name}
                      </a>
                    <div className="flex flex-wrap gap-x-2 text-xs text-slate-500">
                      <span className="font-medium text-slate-600">{cert.issuer}</span>
                      <span>•</span>
                      <span>{cert.year}</span>
                    </div>
                  </div>
                ))}
              </div>
            </div>

          </div>
        </div>

      </div>
    </div>
  );

  return (
    <div className="min-h-screen bg-white font-sans text-slate-900 flex flex-col">
      <Navbar />
      <GlobalSearch />
      <ContactModal />
      <div className="flex-grow">
        {currentView === 'home' && <HomeView />}
        {currentView === 'cv' && <CVView />}
        {currentView === 'projects' && <ProjectsView />}
        {currentView === 'research' && <ResearchView />}
        {currentView === 'project-detail' && <ProjectDetailView />}
        {currentView === 'research-detail' && <ResearchDetailView />}
      </div>
      <Footer />
    </div>
  );
};

export default App;