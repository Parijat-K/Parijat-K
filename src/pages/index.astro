---
import { getEntry } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import Navigation from '../components/Navigation.astro';
import CVHeader from '../components/cv/CVHeader.astro';
import CVSummary from '../components/cv/CVSummary.astro';
import CVExperience from '../components/cv/CVExperience.astro';
import CVEducation from '../components/cv/CVEducation.astro';
import CVSkills from '../components/cv/CVSkills.astro';
import CVCertifications from '../components/cv/CVCertifications.astro';
import CVAvailability from '../components/cv/CVAvailability.astro';

// Load CV data from content collection
const cvEntry = await getEntry('cv', 'main');
const cv = cvEntry.data;

// SEO metadata
const title = `${cv.personalInfo.name} - CV/Resume`;
const description = cv.summary;
---

<Layout
  title={title}
  description={description}
  type="profile"
>
  <Navigation />

  <main class="py-12">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
      <!-- CV Container with white background and shadow (print-optimized) -->
      <div class="bg-white rounded-lg shadow-2xl p-8 md:p-12">
        <CVHeader personalInfo={cv.personalInfo} />

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <!-- Left Panel: Summary + Experience -->
          <div class="lg:col-span-2 space-y-8">
            <CVSummary summary={cv.summary} />
            <CVExperience experience={cv.experience} />
          </div>

          <!-- Right Panel: Skills → Certifications → Education -->
          <div class="lg:col-span-1 space-y-8">
            <CVSkills categories={cv.skills.categories} />

            {cv.certifications && cv.certifications.length > 0 && (
              <>
                <hr class="border-slate-200" />
                <CVCertifications certifications={cv.certifications} />
              </>
            )}

            <hr class="border-slate-200" />
            <CVEducation education={cv.education} />
          </div>
        </div>

        <!-- Availability integrated at bottom -->
        {cv.availability && (
          <div class="mt-8 md:mt-12 -mx-8 md:-mx-12 -mb-8 md:-mb-12">
            <CVAvailability
              availabilityStatus={cv.availability.message}
              email={cv.personalInfo.email}
              linkedin={cv.personalInfo.linkedin}
            />
          </div>
        )}
      </div>
    </div>
  </main>
</Layout>
