---
import { getCollection, getEntry } from "astro:content";
import { Menu, X, Search } from "lucide-astro";

const { currentPath } = Astro.props;

const resumeData = await getEntry("resume", "main");
const projects = await getCollection("projects");
const publications = await getCollection("publications");
const blogs = await getCollection("blogs");

const hasProjects = projects && projects.length > 0;
const hasPublications = publications && publications.length > 0;
const hasBlogs = blogs && blogs.length > 0;

const navItems = [
  { name: "Home", path: "/", show: true },
  { name: "Projects", path: "/projects", show: hasProjects },
  { name: "Research", path: "/research", show: hasPublications },
  { name: "Blog", path: "/blog", show: hasBlogs },
  { name: "Resume / CV", path: "/cv", show: true },
];

const visibleNavItems = navItems.filter((item) => item.show);
---

<nav class="sticky top-0 z-50 bg-slate-900 text-white shadow-lg print:hidden">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between h-16 items-center">
      <a href="/" class="flex items-center">
        <span class="font-bold text-xl tracking-tight"
          >{resumeData?.data.header.name}</span
        >
      </a>

      <div class="flex items-center gap-4">
        <!-- Desktop Menu -->
        <div class="hidden md:flex items-center space-x-8">
          {
            visibleNavItems.map((item) => (
              <a
                href={item.path}
                class={`text-sm font-medium transition-colors hover:text-indigo-300 ${currentPath === item.path || (currentPath.startsWith(item.path + "/") && item.path !== "/") ? "text-white" : "text-slate-400"}`}
              >
                {item.name}
              </a>
            ))
          }
        </div>

        <div class="flex items-center gap-3">
          <button
            id="search-trigger"
            class="p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-full transition-all cursor-pointer"
            title="Search (Cmd+K)"
          >
            <Search size={20} />
          </button>

          <button
            id="contact-trigger"
            class="hidden md:block px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium rounded-md transition-colors cursor-pointer"
          >
            Contact
          </button>

          <div class="md:hidden">
            <button
              id="mobile-menu-btn"
              class="text-slate-300 hover:text-white"
            >
              <Menu size={24} id="menu-icon" />
              <X size={24} id="close-icon" class="hidden" />
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div
    id="mobile-menu"
    class="hidden md:hidden bg-slate-800 border-t border-slate-700"
  >
    <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
      {
        visibleNavItems.map((item) => (
          <a
            href={item.path}
            class={`block w-full text-left px-3 py-2 rounded-md text-base font-medium ${currentPath === item.path ? "bg-slate-900 text-white" : "text-slate-300 hover:bg-slate-700 hover:text-white"}`}
          >
            {item.name}
          </a>
        ))
      }
      <button
        id="mobile-contact-trigger"
        class="block w-full text-left px-3 py-2 rounded-md text-base font-medium text-indigo-400 hover:bg-slate-700 hover:text-white"
      >
        Contact Me
      </button>
    </div>
  </div>
</nav>
